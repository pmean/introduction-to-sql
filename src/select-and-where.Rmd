---
title: "Retrieving data using the SQL SELECT statement"
author: "Steve Simon"
date: "September 12, 2017"
output: powerpoint_presentation
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

### Working with the fat dataset

We will work with the database cigarette. It is stored as a sqlite database with one table, fat.sqlite. If you do not have this database, you can download it from the github site or you can create it using the program, input-first-file.Rmd.

```{r select-star}
library(sqldf)
db <- dbConnect(SQLite(), dbname="../data/airlines_db.sqlite")
airlines_data <- dbGetQuery(conn=db,
 "SELECT * FROM airline_table")
```

### Description of the fat database
+ The fat database
  + Single table, fat
  + Two measures of percentage body fat
  + Compare to various body dimensions
+ You can find a description of this data set at
  + http://jse.amstat.org/datasets/body.txt
  
<div class="notes">

We will work with the database fat.sqlite. If you do not have this database, you can download it from the github site or you can create it using the program, input-first-file.Rmd.

</div>

### Getting everything (not recommended)
+ SQL code
```{}
select * from fat
```

<div class="notes">

The asterisk is shorthand for every field (variable).

This is not recommended. Getting an entire table will, for many large databases, take too long and produce more output than you would want to look at. I am illustrating it here because you have to start somewhere, and this is about as simple as it gets.

For future work (not this module), try your best to limit your output to a maximum of 20 records and 10 variables. Hallf that many would be ideal. There may be a few examples where you need to display more than this amount of data, so consider this a general guideline and not an absolute requirement.

</div>

### Output

```{r get-everything}
library(sqldf)
db <- dbConnect(SQLite(), dbname="../data/fat.sqlite")

fd <- dbGetQuery(conn=db,
 "SELECT * FROM fat")
fd
>>>>>>> 083bedddd4af6659fc70c17a0dda2a2af967dbb0
```

### Single field

```{r select-single-field}
fd <- dbGetQuery(conn=db,
 "SELECT case_number FROM fat")
dim(fd)
head(fd)
```

### Multiple fields

To select more than one field from a table, separate the field names with commas.

```{r select-multiple-fields}
fd <- dbGetQuery(conn=db,
 "SELECT case_number, age, bmi FROM fat")
dim(fd)
head(fd)
```

### Rename a field

You can change the names of your fields with the AS statement.

```{r as-statement}
fd <- dbGetQuery(conn=db,
 "SELECT case_number AS id, age AS age_in_years, bmi FROM fat")
dim(fd)
head(fd)
```

### Limit

To select a limited number of rows, use the LIMIT command. Different databases will have different syntaxes for this. For details, see https://www.w3schools.com/sql/sql_top.asp.

```{r select-rows}
fd <- dbGetQuery(conn=db,
 "SELECT case_number, age, bmi FROM fat
  LIMIT 10")
dim(fd)
head(fd)
```

### Specific cases

You can select specific cases using the WHERE statement.

```{r specific-cases}
fd <- dbGetQuery(conn=db,
 "SELECT case_number, age, bmi FROM fat
  WHERE case_number=3")
dim(fd)
head(fd)
```

### Range

You can select a range of case_numbers.

```{r range-of-cases}
fd <- dbGetQuery(conn=db,
 "SELECT case_number, age, bmi FROM fat
 WHERE case_number BETWEEN 110 and 113")
dim(fd)
head(fd)
```

### Multiple values

Or multiple values

```{r multiple-values}
fd <- dbGetQuery(conn=db,
 "SELECT case_number, age, bmi FROM fat
  WHERE case_number IN (207, 209, 214, 218, 219)")
dim(fd)
head(fd)
```

### On any variable

You can select on any variable, not just the case_number

```{r select-senior-citizens}
fd <- dbGetQuery(conn=db,
 "SELECT case_number, age, bmi FROM fat
  WHERE age >= 65")
dim(fd)
head(fd)
```

### Combine selections

You can combine selections using Boolean logic (AND, OR, NOT)

```{r select-obese-senior-citizens}
fd <- dbGetQuery(conn=db,
 "SELECT case_number, age, bmi FROM fat
  WHERE age >= 65 AND
    bmi >= 30")
dim(fd)
head(fd)
```


```{r shut-down-gracefully}
dbDisconnect(conn=db)
```

```
