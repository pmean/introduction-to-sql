---
title: "Homework13a"
author: "Steve Simon"
output:
  pdf_document: default
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, 
    encoding=encoding,
    output_dir = "../results", 
    output_format = "all") })  
---

This file was created on 2020-07-24 and last modified on `r Sys.Date()`.

Note: this solution uses R and SQLite. An alternate solution using SAS and Oracle is also available.

Note: Some of the names used in this code are arbitrary and you can choose whatever names you want. To emphasize which names can be modified at your discretion, I am using names of famous statisticians.

The statistician being honored in this code is [Hirotugu Akaike](https://en.wikipedia.org/wiki/Hirotugu_Akaike).

Use the longitudinal_example_db. It is available as on the Canvas website or you can find it on the Insights platform.

1. Do an inner join of baseline_table and one_year_table. Display the first ten rows of data only.

```{r hirotugu_akaike1}
library(sqldf)
akaike <- dbConnect(SQLite(),
  dbname="../data/longitudinal_example_db.sqlite")
hirotugu1 <- dbGetQuery(conn=akaike,  "
    select b.id, b.pk1, o.pk5
      from baseline_table as b
      join one_year_table as o
      on b.id=o.id
    limit 10
")

hirotugu1
dbDisconnect(conn=akaike)
```

2. Explain why id 104 included in this inner join, but not the inner join shown in the video?

3. Count the number of records after an inner join of baseline_table and year_one_table. Compare this to the number of records in the year_one_table.

```{r hirotugu_akaike3}
library(sqldf)
akaike <- dbConnect(SQLite(),
  dbname="../data/longitudinal_example_db.sqlite")
hirotugu3a <- dbGetQuery(conn=akaike,  "
    select count(b.id) as n
      from baseline_table as b
      join one_year_table as o
      on b.id=o.id
")

hirotugu3a
hirotugu3b <- dbGetQuery(conn=akaike,  "
    select count(o.id) as n
      from one_year_table as o
")

hirotugu3b
dbDisconnect(conn=akaike)
```

4. Compute the average pk score at baseline, the average score at one year, and the average change score.

```{r hirotugu_akaike4}
library(sqldf)
akaike <- dbConnect(SQLite(),
  dbname="../data/longitudinal_example_db.sqlite")
hirotugu4 <- dbGetQuery(conn=akaike,  "
    select 
      avg(b.pk1) as pk1_avg,
      avg(o.pk5) as pk5_avg,
      avg(b.pk1)-avg(o.pk5) as change_score
      from baseline_table as b
      join one_year_table as o
      on b.id=o.id
")

hirotugu4
dbDisconnect(conn=akaike)
```

5. Find and list the two labels in migraine_table that do not correspond to any codes in demog_table.

```{r hirotugu_akaike5}
library(sqldf)
akaike <- dbConnect(SQLite(),
  dbname="../data/longitudinal_example_db.sqlite")
hirotugu5 <- dbGetQuery(conn=akaike,  "
    select 
      m.migraine_code, m.migraine_label
      from migraine_table as m
      left join demog_table as d
      on m.migraine_code=d.migraine
      where d.migraine is null
")

hirotugu5
dbDisconnect(conn=akaike)
```

6. Show that there are no unmatched labels or unmatched codes for group_table.

```{r hirotugu_akaike6}
library(sqldf)
akaike <- dbConnect(SQLite(),
  dbname="../data/longitudinal_example_db.sqlite")
hirotugu6 <- dbGetQuery(conn=akaike,  "
    select 
      count(g.group_code) as n
      from group_table as g
      left join demog_table as d
      on g.group_code=d.grp
      where d.grp is null
")

hirotugu6
dbDisconnect(conn=akaike)
```



